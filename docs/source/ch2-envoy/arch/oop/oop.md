# 源码设计



## 设计模式与行话

时常有人问我，如何快速系统地一个领域的知识。现代社会，大部分知识是可以公开访问到的。但让人烦恼的是，文档都有了，源码也有了，文档中的每一个单词都懂，源码中的每一小段好像也懂。但要整体把握一个系统的机理，还是相当困难。我们暂时把范畴缩小到学习一个软件系统，或者直接说，是 Envoy。

Envoy 是开源软件，文档也写得相当细致，这在开源项目中是少有的细致。C++ 14 的写法比起 C 和 C++ 1998 已经很平易近人了。可读性已经比较接近 Java，并且不像看 Linux 内核一样那么多缩写术语。但和任何其它软件源码一样，Envoy 有自己的设计模式和行话术语，要读懂其中的行话，就会事半功倍。



### Callback 回调设计模式



Gang of Four (GoF) 的 《*Design Patterns*》 中，并没有一个设计模式叫 Callback 的。`Callback 设计模式`其实是 [`Observer pattern(观察者模式)`](https://en.wikipedia.org/wiki/Observer_pattern) 的一个变体或应用。



> 观察者模式解决了以下问题：
>
> - 解藕对象之间的一对多依赖关系，而不使对象紧密耦合。
> - 当一个对象更改状态时，应自动更新不限数量的依赖对象。
> - 一个对象可以通知多个其他对象。

以上是  [Wkipedia](https://en.wikipedia.org/wiki/Observer_pattern) 关于`Observer pattern(观察者模式)`  的解释。我觉得本质上，观察者模式 更多是一种运用 agnosticism(不可知论) 让对象依赖反转的设计模式。

在 Envoy 中，它的主要作用是让各子系统在设计时可以互相独立。减少直接（起码是编译期）的依赖。Envoy 大量使用了这种 `Callback 设计模式`，并有自己的命名规范。这是要读懂 Envoy 代码一个首先要过的门槛。





![*OOP 子系统回调设计模式*](./oop-subsystem-callback.drawio.svg)
